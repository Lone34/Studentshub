{% extends "base.html" %}
{% block content %}

<style>
    .upload-zone {
        border: 2px dashed #cbd5e1;
        transition: all 0.3s ease;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
        border-color: #3b82f6;
        background: #eff6ff;
    }

    .upload-zone.has-file {
        border-color: #22c55e;
        background: #f0fdf4;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 pb-10">
    <!-- Header -->
    <div class="max-w-2xl mx-auto pt-8 px-4 mb-6">
        <a href="{{ url_for('library') }}"
            class="text-slate-500 hover:text-blue-600 font-bold text-sm flex items-center gap-2 transition-colors mb-6">
            <i class="fa-solid fa-arrow-left"></i> Back to Library
        </a>

        <div class="text-center mb-8">
            <div
                class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center text-2xl shadow-lg mx-auto mb-4">
                <i class="fa-solid fa-cloud-upload"></i>
            </div>
            <h1 class="text-2xl font-extrabold text-slate-800 mb-2">Upload Document</h1>
            <p class="text-slate-500">Share your notes, exam papers, or assignments and <strong
                    class="text-green-600">earn 1 credit</strong></p>
        </div>
    </div>

    <!-- Upload Form -->
    <div class="max-w-2xl mx-auto px-4">
        <form action="{{ url_for('library_upload') }}" method="POST" enctype="multipart/form-data"
            class="bg-white rounded-3xl shadow-xl shadow-slate-200/60 border border-slate-100 p-8">

            <!-- Title -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-slate-700 mb-2">
                    <i class="fa-solid fa-heading mr-1 text-blue-500"></i> Title / Topic Name *
                </label>
                <input type="text" name="title" required
                    placeholder="e.g., Calculus Final Exam 2024, Physics Chapter 5 Notes"
                    class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all">
            </div>

            <!-- Description -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-slate-700 mb-2">
                    <i class="fa-solid fa-align-left mr-1 text-blue-500"></i> Description
                </label>
                <textarea name="description" rows="3" placeholder="Brief description of the content..."
                    class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all resize-none"></textarea>
            </div>

            <!-- Document Type -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-slate-700 mb-3">
                    <i class="fa-solid fa-tag mr-1 text-blue-500"></i> Document Type *
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label class="doc-type-option">
                        <input type="radio" name="doc_type" value="exam" class="hidden peer">
                        <div
                            class="border-2 border-slate-200 rounded-xl p-3 text-center cursor-pointer peer-checked:border-orange-500 peer-checked:bg-orange-50 transition-all">
                            <i class="fa-solid fa-file-lines text-xl text-orange-500 mb-1"></i>
                            <p class="text-xs font-bold text-slate-700">Exam</p>
                        </div>
                    </label>
                    <label class="doc-type-option">
                        <input type="radio" name="doc_type" value="notes" class="hidden peer" checked>
                        <div
                            class="border-2 border-slate-200 rounded-xl p-3 text-center cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-50 transition-all">
                            <i class="fa-solid fa-note-sticky text-xl text-blue-500 mb-1"></i>
                            <p class="text-xs font-bold text-slate-700">Notes</p>
                        </div>
                    </label>
                    <label class="doc-type-option">
                        <input type="radio" name="doc_type" value="paper" class="hidden peer">
                        <div
                            class="border-2 border-slate-200 rounded-xl p-3 text-center cursor-pointer peer-checked:border-purple-500 peer-checked:bg-purple-50 transition-all">
                            <i class="fa-solid fa-scroll text-xl text-purple-500 mb-1"></i>
                            <p class="text-xs font-bold text-slate-700">Paper</p>
                        </div>
                    </label>
                    <label class="doc-type-option">
                        <input type="radio" name="doc_type" value="assignment" class="hidden peer">
                        <div
                            class="border-2 border-slate-200 rounded-xl p-3 text-center cursor-pointer peer-checked:border-green-500 peer-checked:bg-green-50 transition-all">
                            <i class="fa-solid fa-clipboard text-xl text-green-500 mb-1"></i>
                            <p class="text-xs font-bold text-slate-700">Assignment</p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- File Upload -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-slate-700 mb-2">
                    <i class="fa-solid fa-file-arrow-up mr-1 text-blue-500"></i> Upload File *
                </label>
                <div id="upload-zone" class="upload-zone rounded-2xl p-8 text-center cursor-pointer">
                    <input type="file" name="file" id="file-input" accept=".pdf,.png,.jpg,.jpeg,.gif,.webp" required
                        class="hidden">
                    <div id="upload-placeholder">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-slate-400 mb-3"></i>
                        <p class="text-slate-600 font-bold mb-1">Click to upload or drag & drop</p>
                        <p class="text-xs text-slate-400">PDF, PNG, JPG, JPEG, GIF, WEBP (Max 20MB)</p>
                    </div>
                    <div id="upload-preview" class="hidden">
                        <i class="fa-solid fa-file-check text-4xl text-green-500 mb-3"></i>
                        <p class="text-green-700 font-bold mb-1" id="file-name">File selected</p>
                        <p class="text-xs text-slate-400" id="file-size"></p>
                    </div>
                </div>
            </div>

            <!-- Credit Banner -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-4 mb-6 flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-coins text-2xl text-white"></i>
                </div>
                <div class="text-white">
                    <p class="font-bold">Earn 1 Credit</p>
                    <p class="text-sm opacity-90">You'll receive a credit when your document is uploaded successfully!
                    </p>
                </div>
            </div>

            <!-- Submit -->
            <button type="submit"
                class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-cloud-upload"></i>
                Upload Document
            </button>
        </form>
    </div>
</div>

<script>
    const uploadZone = document.getElementById('upload-zone');
    const fileInput = document.getElementById('file-input');
    const placeholder = document.getElementById('upload-placeholder');
    const preview = document.getElementById('upload-preview');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');

    uploadZone.addEventListener('click', () => fileInput.click());

    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            showFilePreview(e.dataTransfer.files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            showFilePreview(e.target.files[0]);
        }
    });

    function showFilePreview(file) {
        const maxSize = 20 * 1024 * 1024; // 20MB

        if (file.size > maxSize) {
            alert('File too large! Maximum size is 20MB');
            fileInput.value = '';
            return;
        }

        placeholder.classList.add('hidden');
        preview.classList.remove('hidden');
        uploadZone.classList.add('has-file');

        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
</script>

{% endblock %}